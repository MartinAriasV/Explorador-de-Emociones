{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the Emotion Explorer application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        },
        "avatar": {
          "type": "string",
          "description": "User's selected avatar (e.g., an emoji)."
        },
        "entryCount": {
          "type": "number",
          "description": "Total number of diary entries."
        },
        "emotionCount": {
          "type": "number",
          "description": "Total number of custom emotions."
        },
        "lastEntryDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date of the last diary entry."
        },
        "currentStreak": {
          "type": "number",
          "description": "The user's current daily entry streak."
        }
      },
      "required": [
        "id",
        "name",
        "avatar"
      ]
    },
    "Emotion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Emotion",
      "type": "object",
      "description": "Represents an emotion that a user can track in their diary.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Emotion entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the emotion (e.g., 'Joy', 'Sadness')."
        },
        "icon": {
          "type": "string",
          "description": "Emoji or icon representing the emotion."
        },
        "color": {
          "type": "string",
          "description": "Color associated with the emotion (for visual representation)."
        },
        "description": {
          "type": "string",
          "description": "Description of what the emotion means to the user."
        }
      },
      "required": [
        "id",
        "name",
        "icon",
        "color",
        "description"
      ]
    },
    "DiaryEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DiaryEntry",
      "type": "object",
      "description": "Represents a single diary entry recorded by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DiaryEntry entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N DiaryEntry)"
        },
        "emotionId": {
          "type": "string",
          "description": "Reference to Emotion. (Relationship: Emotion 1:N DiaryEntry)"
        },
        "date": {
          "type": "string",
          "description": "Date of the diary entry.",
          "format": "date-time"
        },
        "text": {
          "type": "string",
          "description": "Textual description of the experience."
        }
      },
      "required": [
        "id",
        "userId",
        "emotionId",
        "date",
        "text"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/emotions/{emotionId}",
        "definition": {
          "entityName": "Emotion",
          "schema": {
            "$ref": "#/backend/entities/Emotion"
          },
          "description": "Stores user-defined emotions. Path-based ownership ensures only the user can access their own emotions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "emotionId",
              "description": "The unique identifier for the emotion."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/diaryEntries/{diaryEntryId}",
        "definition": {
          "entityName": "DiaryEntry",
          "schema": {
            "$ref": "#/backend/entities/DiaryEntry"
          },
          "description": "Stores diary entries for a user. Path-based ownership ensures only the user can access their own diary entries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "diaryEntryId",
              "description": "The unique identifier for the diary entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, following the core design principles and strategy mandates. It uses path-based ownership for user-specific data, ensuring authorization independence by avoiding `get()` calls in security rules. Data segregation ensures that all documents within a collection share the same security requirements. The structure explicitly models authorization using path-based ownership where possible to support secure `list` operations (QAPs). The design also incorporates explicit state modeling, predictable schemas, and consistent naming conventions for clarity and maintainability. Specifically, user profiles and diary entries are organized under user-specific paths to enforce ownership. Emotions are stored under the user path to ensure that the user is able to define and customize these entries. By storing data in this way it is not possible to create entries for emotions or diaries that are not owned by the currently authenticated user, thus making the system secure and robust."
  }
}