{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the Emotion Explorer application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        },
        "avatar": {
          "type": "string",
          "description": "User's selected avatar (e.g., emoji)."
        }
      },
      "required": [
        "id",
        "name",
        "avatar"
      ]
    },
    "Emotion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Emotion",
      "type": "object",
      "description": "Represents a specific emotion that a user can track.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the emotion."
        },
        "name": {
          "type": "string",
          "description": "Name of the emotion (e.g., Joy, Sadness)."
        },
        "icon": {
          "type": "string",
          "description": "Emoji or icon representing the emotion."
        },
        "color": {
          "type": "string",
          "description": "Color associated with the emotion, for visual representation.",
          "format": "color"
        },
        "description": {
          "type": "string",
          "description": "Description of what the emotion means to the user."
        }
      },
      "required": [
        "id",
        "name",
        "icon",
        "color"
      ]
    },
    "DiaryEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DiaryEntry",
      "type": "object",
      "description": "Represents a single diary entry recording a user's emotions and experiences on a given date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the diary entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N DiaryEntry)"
        },
        "emotionId": {
          "type": "string",
          "description": "Reference to Emotion. (Relationship: Emotion 1:N DiaryEntry)"
        },
        "date": {
          "type": "string",
          "description": "Date of the diary entry.",
          "format": "date-time"
        },
        "text": {
          "type": "string",
          "description": "Textual description of the user's experiences and feelings."
        }
      },
      "required": [
        "id",
        "userId",
        "emotionId",
        "date",
        "text"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' parameter corresponds to the Firebase Auth UID. This path is used for storing individual user profiles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/emotions/{emotionId}",
        "definition": {
          "entityName": "Emotion",
          "schema": {
            "$ref": "#/backend/entities/Emotion"
          },
          "description": "Stores user-defined emotions. Path-based ownership ensures only the authenticated user can manage emotions under their ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Auth UID."
            },
            {
              "name": "emotionId",
              "description": "The unique ID of the emotion."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/diaryEntries/{diaryEntryId}",
        "definition": {
          "entityName": "DiaryEntry",
          "schema": {
            "$ref": "#/backend/entities/DiaryEntry"
          },
          "description": "Stores diary entries for each user. Includes denormalized 'userId' for authorization independence. Each entry is uniquely identified by 'diaryEntryId'.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Auth UID. Denormalized for authorization."
            },
            {
              "name": "diaryEntryId",
              "description": "The unique ID of the diary entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to store user profiles, emotions, and diary entries in a way that prioritizes security, scalability, and ease of debugging. Authorization Independence is achieved by leveraging path-based ownership for user-specific data and avoiding `get()` calls in security rules. Structural Segregation is applied to maintain a homogeneous security posture within each collection.\n\nSpecifically, user profiles are stored in a dedicated collection. User-specific emotions and diary entries are stored under the user's document ID, ensuring only the authenticated user can access them. This approach denormalizes the user ID into the diary entries, eliminating the need for complex authorization checks that require fetching parent documents.\n\nThe QAPs are supported through this structural design. List operations are secured by path-based rules, ensuring users can only list emotions and entries under their own user ID. The design avoids using rules as filters, instead relying on secure queries within the defined data structure. The membership map is not used since this use-case is not for collaborative data, it is for personal data."
  }
}